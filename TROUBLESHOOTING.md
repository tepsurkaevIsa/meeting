# Решение проблем

## Что было исправлено для реальной работы:

### 1. Улучшена обработка WebRTC соединений
- Добавлена очередь для ICE кандидатов (решает проблему race condition)
- Улучшена обработка состояний соединения
- Добавлено больше STUN серверов для лучшей совместимости

### 2. Улучшена обработка аудио
- Добавлены параметры эхоподавления и шумоподавления
- Добавлен мониторинг уровня аудио
- Улучшена обработка ошибок доступа к микрофону

### 3. Улучшена стабильность
- Правильная очистка ресурсов при отключении
- Обработка переподключений
- Лучшие сообщения об ошибках

## Если звонок не работает:

### Проблема: "Не удалось получить доступ к микрофону"
**Решение:**
1. Проверьте разрешения браузера на доступ к микрофону
2. В Chrome: нажмите на иконку замка слева от адреса → Разрешения → Микрофон → Разрешить
3. Убедитесь, что микрофон подключен и работает
4. Перезагрузите страницу

### Проблема: "Соединение не устанавливается"
**Решение:**
1. Убедитесь, что оба пользователя в одной комнате
2. Проверьте, что оба пользователя разрешили доступ к микрофону
3. Попробуйте переподключиться (завершить звонок и создать новую комнату)
4. Проверьте консоль браузера (F12) на наличие ошибок

### Проблема: "Не слышно собеседника"
**Решение:**
1. Проверьте громкость на устройстве
2. Убедитесь, что микрофон не выключен (кнопка микрофона)
3. Проверьте, что браузер не заблокировал автовоспроизведение звука
4. Попробуйте другой браузер

### Проблема: Работает только на localhost
**Для работы в сети:**
1. WebRTC требует HTTPS для работы в продакшене (кроме localhost)
2. Для локальной сети можно использовать ngrok или локальный HTTPS сервер
3. Или используйте TURN сервер для обхода NAT

### Проблема: Не работает между разными сетями
**Решение:**
1. STUN серверы могут быть недостаточны для некоторых NAT
2. Нужен TURN сервер (требует настройки)
3. Можно использовать бесплатные TURN серверы (например, от Twilio)

## Проверка работы:

1. Откройте консоль браузера (F12 → Console)
2. Проверьте логи подключения
3. Должны быть сообщения:
   - "Подключено к серверу"
   - "Connection state: connected"
   - "ICE connection state: connected"

## Рекомендации:

- Используйте Chrome или Firefox для лучшей совместимости
- Убедитесь, что оба пользователя имеют стабильное интернет-соединение
- Для тестирования откройте приложение в двух разных вкладках браузера
- Проверьте, что файрвол не блокирует WebRTC соединения

